<%# ユーザがログインしてないときだけ、キーメッセージを表示する %>
<% if user_signed_in? %>
<% else %>
<div class="top-image-container">
  <div class="top-image-overray">
    <div class="uk-container uk-position-relative">

      <div class="key-message uk-display-inline-block">
        <p class="uk-margin-large-bottom uk-text-bold font-size-32px">ようこそ Recome へ!</p>

        <p class="uk-text-bold">Recomeでは、エンジニアのあなたが見つけたおすすめweb記事を<br>日本中のエンジニアに共有することができます。</p>
        <p class="uk-text-bold">あなたの「困った！」を解決してくれた記事や<br>「参考になるなぁ」と感心した記事に出会ったら、<br>積極的に共有してみましょう！</p>
      </div>

      <div class="top-page-register display-inline-block">
        <p class="uk-display-inline-block uk-margin-small-right">初めての方は</p>
        <%= link_to "ユーザ登録", new_user_registration_path, class:"uk-button uk-button-primary uk-display-inline-block" %><br>

        <p class="uk-display-inline-block uk-margin-medium-right">登録済の方は<%= link_to "こちら",new_user_session_path %>からログイン</p>

      </div>


    </div>
  </div>  
</div>
<% end %>

<div class="uk-container uk-margin-medium-top top-page-contents uk-margin-xlarge-bottom">
  <div uk-grid>
    <div class="uk-width-1-5">

      <%# 人気タグ一覧 %>
      <p class="margin-bottom-10px">人気のタグ</p>
      <hr class="uk-margin-remove">
        <% @popular_tags.each do |tag| %>
          <%# <p class="margin-top-and-bottom-10px uk-text-small"><%= tag.name %>
          <p class="margin-top-and-bottom-5px uk-text-small uk-link-text" ><%= link_to tag.name, home_tag_ranking_path(tag.name, anchor: "top-page-anchor") %></p>
        <% end %>

      <%# ユーザが登録したお気に入りタグ一覧 %>
      <p class="margin-bottom-10px">お気に入りのタグ</p>
      <hr class="uk-margin-remove">
        <%# ユーザがログインしている場合、タグ一覧を表示 %>
        <% if user_signed_in? %>

          <div id="top-favorite-tag-index">
            <%= render partial: 'home/top_favorite_tag_index', collection: current_user.tags, as: :tag %>
          </div>

        <%# お気に入りタグ編集ボタン %>
        <a class="uk-display-block font-size-13px margin-top-and-bottom-10px uk-link-text" href="#modal-center" uk-toggle>お気に入りタグを編集する</a>

        <%# タグ検索のモーダル %>
        <%= render partial:"layouts/tag_search_modal" %>

        <% else %>

        <%# お気に入りタグ編集ボタン（押すと「ログインしてください」のポップアップが表示される） %>
          <a class="uk-display-block font-size-13px margin-top-and-bottom-10px uk-link-text" href="#modal-center" uk-toggle>お気に入りタグを編集する</a>

          <%# ログインしてくださいの吹き出し %>
          <%= render partial:"layouts/alert_not_sign_in", locals:{subject: "お気に入りタグの編集"} %>
          
        <% end %>
      
    </div>

    <div class="uk-width-expand">
        <span id="top-page-anchor"></span>
        <p class="uk-margin-remove-top">人気の記事</p>

            <div class="uk-child-width uk-grid-medium uk-grid-match" uk-grid>
                <% @articles.each do |article| %>        
                  <div>
                      <div class="uk-card uk-card-default uk-card-small uk-card-hover uk-box-shadow-small">

                            <%# タイトル %>
                            <div class="uk-card-header padding-top-and-bottom-5px">
                              <p class="margin-top-and-bottom-5px uk-display-inline-block font-size-12px">お気に入りに登録された数：<span class="uk-text-small uk-text-bold"><%=article.favorites.count  %></span></p>

                              <%# お気に入りボタン %>
                              <%= render "favorites/favorite_button", article: article  %>

                            </div>

                            <div class="uk-card-body-small padding-top-and-bottom-10px" uk-grid>
                                <div class="uk-width-auto url-image padding-left-55px">
                                    <%# サムネイル画像 %>
                                    <%= image_tag article.thumbnail_image_url, style:"height:60px;width:80px;object-fit:cover;" %>
                                </div>
                                <div class="uk-width-expand padding-rignt-and-left-15px">
                                  <%# 記事タイトル %>
                                  <p class="uk-text-small uk-text-bold uk-margin-remove uk-link-text"><%=link_to article.title.truncate(60),article.url %></p>
                                  <p class="font-size-12px margin-top-and-bottom-5px"><%= article.site_name %></p>
                                  <%# <p class="uk-margin-remove-top font-size-12px margin-bottom-10px" ><%= article.description.truncate(120) %>

                                  <%# タグの表示 %>
                                  <%= render "layouts/tag", article: article  %>

                                </div>
                            </div>

                            <%# おすすめコメント %>

                            <div class="padding-5px flex-space-between uk-background-muted">
                              <div class="mini-container uk-margin-small-right">
                                  <%= link_to user_path(article.user),class:"uk-link-text" do %>
                                  <%= attachment_image_tag article.user, :profile_image,fallback: "no-user-image.png",size:'30x30', class: "uk-border-circle user-show-image-index",alt: "Border circle", id: "profileImage" %>
                                  <%# ユーザ名 %>
                                  <div class="uk-display-inline-block uk-margin-small-left">
                                    <p class="font-size-11px uk-margin-remove"><%= article.user.user_name %></p>
                                    <% end %>  

                                    <%# おすすめ文 %>
                                    <p class="font-size-12px margin-top-and-bottom-5px"><%= article.recommend_comment %></p> 
                                  </div>
                              </div>  

                            </div>


                      </div>
                  </div>
                <% end %>
            </div>

        <%# ページネーション %>
        <div class= "paginate uk-text-center uk-margin-medium-top">
          <%= paginate @articles, class: "paginate uk-pagination" %>
        </div>

    </div>

    <div class="uk-width-1-4">

      <div class="uk-container"> 
        <p>ユーザランキング</p>
          <% @users.each.with_index(1) do |user,i| %>
            <div class="padding-5px flex-space-between">

                  <span><%= i %>位</span>

                  <div class="uk-width-expand uk-margin-small-left">
                    <%= link_to user_path(user),class:"uk-link-text" do %>
                      <%# プロフィール画像 %>
                      <%= attachment_image_tag user, :profile_image,fallback: "no-user-image.png",size:'30x30', class: "uk-border-circle user-show-image-index",alt: "Border circle", id: "profileImage" %>
                      <%# ユーザ名 %>
                        <p class="font-size-12px uk-margin-remove uk-display-inline-block"><%= user.user_name %></p>
                    <% end %>
                  </div>    

                    <div class="uk-display-inline-block">
                      <p class="font-size-10px uk-margin-remove">お気に入りされた数</p>
                      <p class="uk-margin-remove uk-text-bold uk-text-center"><%= user.count_all_favorites %></p>
                    </div>

            </div>
            <hr class="uk-margin-remove">
            <% end %>
      </div>  

    <div>
  </div> 
</div>